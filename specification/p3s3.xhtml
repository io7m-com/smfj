<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>com.io7m.smfj 0.11.0 Specification: 3.3. Sections</title><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><link rel="stylesheet" type="text/css" href="kstructural-layout.css"/><link rel="stylesheet" type="text/css" href="kstructural-colour.css"/><link rel="stylesheet" type="text/css" href="specification.css"/></head><body><div class="st300_body"><div class="st300_navbar st300_navbar_top"><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_title_cell">3.2. Header</td><td class="st300_navbar_up_title_cell">3. SMF/B - Binary Encoding</td><td class="st300_navbar_next_title_cell">3.4. Section - end</td></tr><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p3s2.xhtml#st300_p3s2" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p3.xhtml#st300_p3" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p3s4.xhtml#st300_p3s4" title="Go to next page">Next</a></td></tr></table><hr class="st300_hr"/></div><div class="st300_section_container"><a id="smfb.sections"/><div class="st300_section_title_number"><a id="st300_p3s3" href="#st300_p3s3" title="Section 3.3: Sections">3.3</a></div><div class="st300_section_title">Sections</div><ul class="st300_contents st300_section_contents_outer st300_section_contents"><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p3s3.xhtml#st300_p3s3ss1" title="Link to subsection 3.3.1: Definition">3.3.1. Definition</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p3s3.xhtml#st300_p3s3ss2" title="Link to subsection 3.3.2: Alignment">3.3.2. Alignment</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p3s3.xhtml#st300_p3s3ss3" title="Link to subsection 3.3.3: Available Sections">3.3.3. Available Sections</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p3s3.xhtml#st300_p3s3ss4" title="Link to subsection 3.3.4: Enumerating Sections">3.3.4. Enumerating Sections</a></li></ul><div class="st300_subsection_container"><a id="smfb.sections.def"/><div class="st300_subsection_title_number"><a id="st300_p3s3ss1" href="#st300_p3s3ss1" title="Subsection 3.3.1: Definition">3.3.1</a></div><div class="st300_subsection_title">Definition</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss1c1" href="#st300_p3s3ss1c1" title="Paragraph 3.3.1.1">1</a></div><div class="st300_paragraph">Directly following the <a class="st300_link" href="p3s2.xhtml#smfb.header">header</a>, an <span class="st300_term type">SMF/B</span> file consists of a series of <span class="st300_term term">sections</span>. A <span class="st300_term term">section</span> begins with the following fixed-size structure:</div></div><div class="st300_formal_item"><a id="smfb.sections.def.header"/><div class="st300_formal_item_title"><a id="st300_p3s3ss1c2" href="#st300_p3s3ss1c2" title="Formal item 3.3.1.2: Section header">3.3.1.2 Section header</a></div><div class="st300_formal_item_content"><pre class="st300_verbatim">[record SMFBSection
  ([field id   [integer unsigned 64]]
   [field size [integer unsigned 64]])]
</pre></div></div><div class="st300_paragraph_container"><a id="smfb.sections.def.size"/><div class="st300_paragraph_number"><a id="st300_p3s3ss1c3" href="#st300_p3s3ss1c3" title="Paragraph 3.3.1.3">3</a></div><div class="st300_paragraph">The <span class="st300_term field">id</span> field of the section header identifies the type of the section. The <span class="st300_term field">size</span> field of the section header specifies the <span class="st300_term term">data size</span>; the size in octets of the data that follows the section header. The <span class="st300_term term">data size</span> necessarily includes any trailing <span class="st300_term term">padding octets</span> that may be inserted in order to guarantee that the start of the <span class="st300_term term">next</span> section (if any) is correctly <a class="st300_link" href="p3s3.xhtml#smfb.sections.alignment">aligned</a>. This implies that the <span class="st300_term term">data size</span> of any given section MUST be a multiple of the <a class="st300_link" href="p3s3.xhtml#smfb.sections.alignment">alignment</a> size.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss1c4" href="#st300_p3s3ss1c4" title="Paragraph 3.3.1.4">4</a></div><div class="st300_paragraph">Implementations MUST ignore any content inside a section of an unrecognized type <span class="st300_footnote_reference">[<a href="p3s3.xhtml#st300_f_2286_0" id="st300_fr_2256" title="Jump to footnote smfb.sections.compat (reference 0)">3</a>]</span>. As sections explicitly state the size of their own data, implementations can simply seek forwards in the file by the specified data size to reach the next section.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss1c5" href="#st300_p3s3ss1c5" title="Paragraph 3.3.1.5">5</a></div><div class="st300_paragraph">The first section in an <span class="st300_term type">SMF/B</span> file MUST be an <a class="st300_link" href="p3s5.xhtml#smfb.sections.smf">smf</a> section. The last section in an <span class="st300_term type">SMF/B</span> file MUST be an <a class="st300_link" href="p3s4.xhtml#smfb.sections.end">end</a> section.</div></div></div><div class="st300_subsection_container"><a id="smfb.sections.alignment"/><div class="st300_subsection_title_number"><a id="st300_p3s3ss2" href="#st300_p3s3ss2" title="Subsection 3.3.2: Alignment">3.3.2</a></div><div class="st300_subsection_title">Alignment</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss2c1" href="#st300_p3s3ss2c1" title="Paragraph 3.3.2.1">1</a></div><div class="st300_paragraph">Sections MUST be aligned to <span class="st300_term constant">16</span> octet boundaries. As the section <a class="st300_link" href="p3s2.xhtml#smfb.header">header</a> is defined to be exactly <span class="st300_term constant">16</span> octets, this implies that the data within a section will also be aligned to a <span class="st300_term constant">16</span> octet boundary <span class="st300_footnote_reference">[<a href="p3s3.xhtml#st300_f_2433_0" id="st300_fr_2417" title="Jump to footnote smfb.sections.alignment.vector (reference 0)">4</a>]</span>. Implementations MUST reject <span class="st300_term type">SMF/B</span> files containing one or more incorrectly aligned sections.</div></div></div><div class="st300_subsection_container"><a id="smfb.sections.available"/><div class="st300_subsection_title_number"><a id="st300_p3s3ss3" href="#st300_p3s3ss3" title="Subsection 3.3.3: Available Sections">3.3.3</a></div><div class="st300_subsection_title">Available Sections</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss3c1" href="#st300_p3s3ss3c1" title="Paragraph 3.3.3.1">1</a></div><div class="st300_paragraph">This version of the specification defines the following sections:</div></div><div class="st300_formal_item"><a id="smfb.sections.list"/><div class="st300_formal_item_title"><a id="st300_p3s3ss3c2" href="#st300_p3s3ss3c2" title="Formal item 3.3.3.2: Sections">3.3.3.2 Sections</a></div><div class="st300_formal_item_content"><ul class="st300_list_unordered"><li class="st300_list_item"><a class="st300_link" href="p3s4.xhtml#smfb.sections.end">end</a></li><li class="st300_list_item"><a class="st300_link" href="p3s8.xhtml#smfb.sections.metadata">metadata</a></li><li class="st300_list_item"><a class="st300_link" href="p3s5.xhtml#smfb.sections.smf">smf</a></li><li class="st300_list_item"><a class="st300_link" href="p3s6.xhtml#smfb.sections.triangles">triangles</a></li><li class="st300_list_item"><a class="st300_link" href="p3s7.xhtml#smfb.sections.vertices-noninterleaved">vertices-noninterleaved</a></li></ul></div></div></div><div class="st300_subsection_container"><a id="smfb.sections.enumerating"/><div class="st300_subsection_title_number"><a id="st300_p3s3ss4" href="#st300_p3s3ss4" title="Subsection 3.3.4: Enumerating Sections">3.3.4</a></div><div class="st300_subsection_title">Enumerating Sections</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss4c1" href="#st300_p3s3ss4c1" title="Paragraph 3.3.4.1">1</a></div><div class="st300_paragraph">Note: This subsection is <span class="st300_term term">informative</span>.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss4c2" href="#st300_p3s3ss4c2" title="Paragraph 3.3.4.2">2</a></div><div class="st300_paragraph">The design of sections allows for implementations to quickly enumerate all sections within a file using the following strategy:</div></div><div class="st300_formal_item"><a id="smfb.sections.enumerating.example"/><div class="st300_formal_item_title"><a id="st300_p3s3ss4c3" href="#st300_p3s3ss4c3" title="Formal item 3.3.4.3: Enumerating Sections">3.3.4.3 Enumerating Sections</a></div><div class="st300_formal_item_content"><pre class="st300_verbatim">void showSections()
{
  // Read SMF header
  long smf = readUnsigned64();
  int major = readUnsigned32();
  int minor = readUnsigned32();

  // Read all sections
  while (bytesRemaining()) {
    long offset = currentOffset();
    long magic = readUnsigned64();
    long size = readUnsigned64();

    System.out.printf(
    "section: %s %s %s\n",
    Long.toUnsignedString(offset),
    Long.toUnsignedString(magic, 16),
    Long.toUnsignedString(size));

    seek(size);
  }
}</pre></div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p3s3ss4c4" href="#st300_p3s3ss4c4" title="Paragraph 3.3.4.4">4</a></div><div class="st300_paragraph">The <span class="st300_term function">bytesAvailable</span> method is assumed to return <span class="st300_term constant">true</span> if there are any bytes remaining in the file. The <span class="st300_term function">currentOffset</span> method is assumed to return the current read position in octets within the file. The <span class="st300_term function">readUnsigned64</span> method is assumed to read a 64-bit big-endian integer from the current file, advancing the current read position by 8 octets. The <span class="st300_term function">readUnsigned32</span> method is assumed to read a 32-bit big-endian integer from the current file, advancing the current read position by 4 octets.</div></div></div><div class="st300_footnotes"><hr/><div class="st300_footnote_container"><div class="st300_footnote_id">[<a id="st300_f_2286_0" href="p3s3.xhtml#st300_fr_2256" title="Jump back to reference 0 of footnote smfb.sections.compat">3</a>]</div><div class="st300_footnote_body">Ignoring unrecognized sections allows for forwards compatibility: An implementation supporting version <span class="st300_term expression">m</span> can read a file of version <span class="st300_term expression">n</span>, where <span class="st300_term expression">m &lt; n</span>, and ignore any new sections specified by format <span class="st300_term expression">n</span> that it does not understand.</div></div><div class="st300_footnote_container"><div class="st300_footnote_id">[<a id="st300_f_2433_0" href="p3s3.xhtml#st300_fr_2417" title="Jump back to reference 0 of footnote smfb.sections.alignment.vector">4</a>]</div><div class="st300_footnote_body">The requirement for data to be aligned to <span class="st300_term constant">16</span> octet boundaries is intended to facilitate implementations using vector instruction sets such as <a class="st300_link_external" href="https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions">SSE</a> to efficiently operate on memory-mapped <span class="st300_term type">SMF/B</span> files.</div></div></div></div><div class="st300_navbar st300_navbar_bottom"><hr class="st300_hr"/><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p3s2.xhtml#st300_p3s2" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p3.xhtml#st300_p3" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p3s4.xhtml#st300_p3s4" title="Go to next page">Next</a></td></tr><tr><td class="st300_navbar_prev_title_cell">3.2. Header</td><td class="st300_navbar_up_title_cell">3. SMF/B - Binary Encoding</td><td class="st300_navbar_next_title_cell">3.4. Section - end</td></tr></table></div></div></body></html>
